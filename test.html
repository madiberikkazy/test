<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –¢–∞“£–¥–∞“£—ã–∑</title>
    <style>
        /* ... —Å—ñ–∑–¥—ñ“£ –±“±—Ä—ã–Ω“ì—ã —Å—Ç–∏–ª—å–¥–µ—Ä—ñ“£—ñ–∑ ... */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        #lesson-screen { max-width: 1400px; margin: 0 auto; }
        .main-title { text-align: center; color: white; font-size: 2.5em; margin-bottom: 40px; }
        .lesson-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        .lesson-card { background: white; border-radius: 20px; padding: 40px 30px; text-align: center; cursor: pointer; transition: 0.3s; }
        .lesson-icon { width: 80px; height: 80px; background: #4ecdc4; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 30px; color: white; }
        .start-btn { background: #667eea; color: white; border: none; padding: 10px 25px; border-radius: 20px; cursor: pointer; }
        #question-screen { display: none; max-width: 700px; margin: 0 auto; }
        .question-card { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .variant { padding: 15px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 10px; cursor: pointer; }
        .variant.correct { background: #d4edda; border-color: #28a745; }
        .variant.incorrect { background: #f8d7da; border-color: #dc3545; }
        .navigation { display: flex; justify-content: space-between; margin-top: 20px; }
        .nav-btn { padding: 10px 20px; border-radius: 20px; border: none; cursor: pointer; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 15% auto; padding: 30px; width: 300px; border-radius: 15px; text-align: center; }
    </style>
</head>
<body>

    <script type="module">
        import { auth } from './firebase.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã“£ –∂“Ø–π–µ–≥–µ –∫—ñ—Ä–≥–µ–Ω—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É
        onAuthStateChanged(auth, user => {
            if (!user) {
                window.location.href = "index.html";
            }
        });
    </script>

    <div id="lesson-screen">
        <h1 class="main-title">–¢–ï–°–¢ –¢–ê“¢–î–ê“¢–´–ó üìö</h1>
        <div class="lesson-grid">
            <div class="lesson-card" onclick="selectLesson('musaif.txt', '–§–∏–ª–æ—Å–æ—Ñ–∏—è')">
                <div class="lesson-icon">üß†</div>
                <div class="lesson-title">–§–∏–ª–æ—Å–æ—Ñ–∏—è</div>
                <button class="start-btn">–ë–∞—Å—Ç–∞—É ‚ñ∂</button>
            </div>
        </div>
    </div>

    <div id="question-screen">
        <div class="question-card">
            <h3 id="current-lesson-name">–¢–ï–°–¢</h3>
            <p id="question-counter"></p>
            <div id="question-text" style="font-size: 1.2em; margin: 20px 0; font-weight: bold;"></div>
            <div id="variants-container"></div>
            <div class="navigation">
                <button class="nav-btn" onclick="openJumpModal()">‚Ññ</button>
                <button class="nav-btn" id="next-btn" onclick="nextQuestion()" disabled>–ö–µ–ª–µ—Å—ñ</button>
            </div>
        </div>
    </div>

    <div id="jumpModal" class="modal">
        <div class="modal-content">
            <h4>–°“±—Ä–∞“õ –Ω”©–º—ñ—Ä—ñ</h4>
            <input type="number" id="jumpInput" style="width: 100%; margin: 10px 0; padding: 5px;">
            <button onclick="jumpToQuestion()">”®—Ç—É</button>
            <button onclick="closeJumpModal()">–ñ–∞–±—É</button>
        </div>
    </div>

    <script>
        // –õ–æ–≥–∏–∫–∞–ª—ã“õ —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä (selectLesson, showQuestion, —Ç.–±.) –±“±—Ä—ã–Ω“ì—ã “õ–∞–ª–ø—ã–Ω–¥–∞ “õ–∞–ª–∞–¥—ã
        let questions = [];
        let currentQuestionIndex = 0;
        let correctAnswers = 0;

        async function selectLesson(filename, name) {
            try {
                const response = await fetch(filename);
                const data = await response.text();
                questions = parseTestData(data);
                document.getElementById('lesson-screen').style.display = 'none';
                document.getElementById('question-screen').style.display = 'block';
                document.getElementById('current-lesson-name').textContent = name;
                showQuestion();
            } catch (e) { alert("–§–∞–π–ª —Ç–∞–±—ã–ª–º–∞–¥—ã!"); }
        }

        function parseTestData(data) {
            return data.split('<question>').filter(b => b.trim()).map(block => {
                const parts = block.split('<variant>');
                return {
                    text: parts[0].trim(),
                    variants: parts.slice(1).map(v => v.trim()).sort(() => Math.random() - 0.5),
                    correct: parts[1].trim(),
                    answered: false
                };
            });
        }

        function showQuestion() {
            const q = questions[currentQuestionIndex];
            document.getElementById('question-counter').textContent = `–°“±—Ä–∞“õ ${currentQuestionIndex + 1} / ${questions.length}`;
            document.getElementById('question-text').textContent = q.text;
            const container = document.getElementById('variants-container');
            container.innerHTML = '';
            
            q.variants.forEach(v => {
                const div = document.createElement('div');
                div.className = 'variant';
                div.textContent = v;
                div.onclick = () => {
                    if(!q.answered) {
                        q.answered = true;
                        if(v === q.correct) { div.classList.add('correct'); correctAnswers++; }
                        else div.classList.add('incorrect');
                        document.getElementById('next-btn').disabled = false;
                    }
                };
                container.appendChild(div);
            });
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if(currentQuestionIndex < questions.length) {
                document.getElementById('next-btn').disabled = true;
                showQuestion();
            } else {
                alert(`–ê—è“õ—Ç–∞–ª–¥—ã! –ù”ô—Ç–∏–∂–µ: ${correctAnswers}/${questions.length}`);
                location.reload();
            }
        }

        function openJumpModal() { document.getElementById('jumpModal').style.display = 'block'; }
        function closeJumpModal() { document.getElementById('jumpModal').style.display = 'none'; }
        function jumpToQuestion() {
            const val = parseInt(document.getElementById('jumpInput').value);
            if(val > 0 && val <= questions.length) {
                currentQuestionIndex = val - 1;
                showQuestion();
                closeJumpModal();
            }
        }
    </script>
</body>
</html>